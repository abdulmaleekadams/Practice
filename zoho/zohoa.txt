// Define the 'response' variable as a Map
response = Map();

// Define a map to store queries and responses
responses = Map();

// Populate the map with queries and responses
// responses.put("my question","my answer");
// responses.put("What is Corebank USSD?","*5334#");
// responses.put("How do I open a savings account with your MFB?", "To open a savings account with us, visit any of our branches with a valid ID card, proof of address, and an initial deposit of â‚¦5,000.");
// responses.put("What is the interest rate for fixed deposit accounts?", "Our fixed deposit interest rates vary depending on the tenure. Please visit our website or contact our nearest branch for the current rates.");
// responses.put("Can I transfer money to other banks using your mobile app?", "Yes, our mobile app allows you to transfer funds to accounts in other banks. Simply log in and choose the 'Transfer' option.");
// responses.put("How do I reset my online banking password?", "You can reset your password by clicking the 'Forgot Password' link on our online banking login page and following the instructions.");
// responses.put("What is the USSD code for checking my account balance?", "To check your account balance, dial *XYZ# and follow the on-screen prompts.");
// responses.put("Do you offer foreign exchange services?", "Yes, we provide foreign exchange services for currency conversion and foreign currency transactions.");
// responses.put("How can I subscribe to SMS alerts for account transactions?", "You can subscribe to SMS alerts through online banking or by visiting a branch. Choose the alert preferences that suit you.");
// Add more queries and responses related to banking here

// Get the user's message
msg = message.get("text");

// Check if the message is in the map, and if so, provide the response
if(operation.equals("chat"))
{
	if(msg.isNull() || msg.isEmpty())
	{
		response.put("action","reply");
		response.put("replies",{"It seems like your message is empty. If you have any questions or need assistance with anything specific, please feel free to ask, and I'll be happy to help!"});
		return response;
	}
	 if(msg.equalsIgnoreCase("I'm new here, just browsing"))
  {
    response.put("action","context");
    response.put("context_id","browsing");
    question = {"name":"ussd","replies":{"Awesome. Letâ€™s get you started right away. Hereâ€™s an on demand [product demo](https://www.zoho.com/social/webinars/social-media-marketing.html) that you can watch at your own pace."},"suggestions":{"Thanks"}};
    response.put("questions",{question});
  }
	else if(responses.containsKey(msg))
	{
		response.put("action","reply");
		response.put("replies",{responses.get(msg)});
	}
	else
	{
		response.put("action","reply");
		response.put("replies",List("I'm sorry, I don't have information on that. Please contact our customer support for assistance."));
	}
}

return response;












response = Map();
response.put("action","context");
response.put("context_id",context_id);
if(context_id.equals("ussd"))
{
	ussd = answers.get("ussd").get("text");
	if(ussd.equalsIgnoreCase("ussd"))
	{
		response.put("action","reply");
		response.put("replies",{"Corebank's USSD code is *5334#"});
		response.put("suggestions",{"Why was I charged for using the USSD code"});
	}
	else
	{
		response.put("action","reply");
		response.put("replies",{"What else can I help you with?"});
		response.put("suggestions",{"I'm new here, just browsing","I'm an existing customer and need help","I want a product demo"});
	}
}
else if(context_id.equals("help"))
{
	help = answers.get("help").get("text");
	if(help.equalsIgnoreCase("Questions about the product"))
	{
		if(!answers.containsKey("elsepart"))
		{
			question = {"name":"elsepart","replies":{"Sure! You might want to check out the [Resources page](https://www.zoho.com/social/help/) . It has a product guide, answers to frequently asked questions, and more.","Is there any thing else that I can assist you with?"},"input":{"type":"select","options":{"Yes, I need help","No, Thank you"}}};
			response.put("questions",{question});
		}
		else
		{
			elsepart = answers.get("elsepart").get("text");
			if(elsepart.equalsIgnoreCase("Yes, I need help"))
			{
				if(!answers.containsKey("email"))
				{
					question = {"name":"email","replies":{{"text":"Can I have your email address so that we can reach you in case the chat gets disconnected","field_name":"siq_email","validate":{"format":"email","error":{"Enter a valid email"}}}}};
					response.put("questions",{question});
				}
				else
				{
					email = answers.get("email").get("text");
					if(!answers.containsKey("name"))
					{
						question = {"name":"name","replies":{{"text":"Can I have your name please?","field_name":"siq_name"}}};
						response.put("questions",{question});
					}
					else
					{
						name = answers.get("name").get("text");
						if(!answers.containsKey("phone"))
						{
							question = {"name":"phone","replies":{{"text":"Can I have your phone number in case we need to reach out to you for further follow up","validate":{"format":"phoneno","error":{"Enter a valid phone number"}},"field_name":"siq_phone"}}};
							response.put("questions",{question});
						}
						else
						{
							phone = answers.get("phone").get("text");
							response.put("action","forward");
							response.put("replies",{"Please wait while I forward the chat to agents"});
						}
					}
				}
			}
			else if(elsepart.equalsIgnoreCase("No, Thank you"))
			{
				if(!answers.containsKey("anythingelse"))
				{
					question = {"name":"anythingelse","replies":{"Is there any thing else that I can assist you with?"},"input":{"type":"select","options":{"Yes","No"}}};
					response.put("questions",{question});
				}
				else
				{
					anythingelse = answers.get("anythingelse").get("text");
					if(anythingelse.equalsIgnoreCase("Yes"))
					{
						response.put("action","reply");
						response.put("replies",{"Hello there! ðŸ‘‹ Looking for anything specific?"});
						response.put("suggestions",{"I'm new here, just browsing","I'm an existing customer and need help","I want a product demo"});
					}
					else
					{
						response.put("action","end");
						response.put("replies",{"Bye"});
					}
				}
			}
		}
	}
	else if(help.equalsIgnoreCase("Sales Enquiry"))
	{
		if(!answers.containsKey("email"))
		{
			question = {"name":"email","replies":{{"text":"Can I have your email address so that we can reach you in case the chat gets disconnected","field_name":"siq_email","validate":{"format":"email","error":{"Enter a valid email"}}}}};
			response.put("questions",{question});
		}
		else
		{
			email = answers.get("email").get("text");
			if(!answers.containsKey("name"))
			{
				question = {"name":"name","replies":{{"text":"Can I have your name please?","field_name":"siq_name"}}};
				response.put("questions",{question});
			}
			else
			{
				name = answers.get("name").get("text");
				if(!answers.containsKey("phone"))
				{
					question = {"name":"phone","replies":{{"text":"Can I have your phone number in case we need to reach out to you for further follow up","validate":{"format":"phoneno","error":{"Enter a valid phone number"}},"field_name":"siq_phone"}}};
					response.put("questions",{question});
				}
				else
				{
					phone = answers.get("phone").get("text");
					response.put("action","forward");
					response.put("replies",{"Please wait while I forward the chat to agents"});
				}
			}
		}
	}
	else if(help.equalsIgnoreCase("Can't find what I'm looking for"))
	{
		if(!answers.containsKey("email"))
		{
			question = {"name":"email","replies":{"Uh-oh! Sorry about that.",{"text":"Do you have an email address where we can reach you?","validate":{"format":"email","error":{"Please enter a valid email"}},"field_name":"siq_email"}}};
			response.put("questions",{question});
		}
		else
		{
			email = answers.get("email").get("text");
			if(!answers.containsKey("name"))
			{
				question = {"name":"name","replies":{{"text":"What's your name?","field_name":"siq_name"}}};
				response.put("questions",{question});
			}
			else
			{
				// handle failure
				name = answers.get("name").get("text");
				response.put("action","forward");
				response.put("replies",{"Please wait while I transfer your chat to the agents"});
			}
		}
	}
	else
	{
		question = {"name":"help","replies":{"Welcome back! What do you need help with?"},"suggestions":{"Questions about the product","Sales Enquiry","Can't find what I'm looking for"}};
		response.put("questions",{question});
	}
}
else if(context_id.equals("demo"))
{
	time = answers.get("time").get("text");
	if(!answers.containsKey("email"))
	{
		question = {"name":"email","replies":{{"text":"Do you have an email address where we can reach you?","field_name":"siq_email","validate":{"format":"email","error":{"Enter a valid email"}}}}};
		response.put("questions",{question});
	}
	else
	{
		email = answers.get("email").get("text");
		response.put("action","end");
		response.put("replies",{"Thanks! One of our product specialists will reach out to you soon."});
	}
}
return response;
